default:
    @just --list

# --- BACKEND ---

gen:
    cd backend && protoc --go_out=. --go_opt=paths=source_relative \
           --go-grpc_out=. --go-grpc_opt=paths=source_relative \
           proto/helloworld/helloworld.proto

run-back:
    cd backend && go run main.go

deps-back:
    cd backend && go mod tidy && gomod2nix

# --- FRONTEND (Yarn) ---

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Å–æ–∑–¥–∞—Å—Ç/–æ–±–Ω–æ–≤–∏—Ç yarn.lock)
deps-front:
    cd frontend && yarn install

# –ó–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞
dev-front:
    cd frontend && yarn dev

# –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏ –≤—Ä—É—á–Ω—É—é
build-front:
    cd frontend && yarn build

# --- FULL APP ---

# –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ (—Å–Ω–∞—á–∞–ª–∞ –±–∏–ª–¥–∏—Ç —Ñ—Ä–æ–Ω—Ç, –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç –±—ç–∫)
run:
    @echo "üì¶ Building frontend..."
    cd frontend && yarn build
    @echo "üöÄ Starting Backend..."
    cd backend && SERVER_STATIC_DIR=../frontend/dist go run main.go

# –°–±–æ—Ä–∫–∞ —á–µ—Ä–µ–∑ Nix
build:
    nix build .

grcp-curl:
  grpcurl -plaintext -d '{"name": "Developer"}' localhost:50051 helloworld.Greeter/SayHello
