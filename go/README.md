# Project Commands

## ðŸš€ Quick Start

```bash
just setup          # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹, Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ proto, Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð°
just start          # Ð—Ð°Ð¿ÑƒÑÐº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² (Gateway, Shell, Greeter)
```

## ðŸ›  Development

```bash
just dev-all        # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
just dev-gateway    # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Gateway
just dev-shell      # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Shell (Host)
just dev-greeter    # Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Greeter
```

Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°Ð¼Ð¸:
```bash
just restart        # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
just kill-all       # ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹ Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚Ñ‹
just kill-ports     # Ð¢Ð¾Ñ‡ÐµÑ‡Ð½Ð¾ ÑƒÐ±Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ð°Ñ… 8080, 8081, 9002, 50051
```

## ðŸ”­ Observability (Loki, Grafana, Tempo)

Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚ÐµÐºÐ¾Ð¼ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° (Docker Compose):
```bash
just up-obs         # ÐŸÐ¾Ð´Ð½ÑÑ‚ÑŒ ÑÑ‚ÐµÐº (Grafana:3001, Loki:3100, VM:8428)
just down-obs       # ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚ÐµÐº
just logs-obs       # Ð›Ð¾Ð³Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð² Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
```

## ðŸ“‹ Logs & Debugging

Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ (Ð¿Ð¸ÑˆÑƒÑ‚ÑÑ Ð² `/tmp/*.log`):
```bash
just logs-local-all     # tail -f Ð²ÑÐµÑ… Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð»Ð¾Ð³Ð¾Ð²
just logs-gateway-local # Ð›Ð¾Ð³Ð¸ Gateway
just logs-shell-local   # Ð›Ð¾Ð³Ð¸ Shell
```

Ð›Ð¾Ð³Ð¸ Ð¸Ð· Loki (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ `just up-obs`):
```bash
just logs-all       # Ð’ÑÐµ Ð»Ð¾Ð³Ð¸ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ‡Ð°Ñ
just logs-greeter   # Ð›Ð¾Ð³Ð¸ ÑÐµÑ€Ð²Ð¸ÑÐ° Greeter
just logs-gateway   # Ð›Ð¾Ð³Ð¸ Gateway/Envoy
just logs-errors    # Ð’ÑÐµ Ð»Ð¾Ð³Ð¸ Ñ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ ERROR
just loki-status    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Loki
```

## ðŸ§ª Testing & Checks

```bash
just test           # Ð—Ð°Ð¿ÑƒÑÐº Go Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Nix flake
just check          # Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° (Nix flake check)
```

## ðŸ“¦ Build (Nix)

```bash
just build          # Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹
just build-gateway  # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Gateway
just build-shell    # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Shell
just build-greeter  # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Greeter
```

## âš™ï¸ Configuration

```bash
just config-init    # Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ local.env Ð¸Ð· Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°
just config-dev     # ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ dev ÐºÐ¾Ð½Ñ„Ð¸Ð³
just info           # ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ð¾Ñ€Ñ‚Ð°Ñ… Ð¸ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ð°Ñ…
```

---

# Frontend Federation

## ÐšÐ°Ðº Ð¿Ð¾Ð½ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð½Ð°ÐºÐ¾ÑÑÑ‡Ð¸Ð» Ð²Ð¾ Ñ„Ñ€Ð¾Ð½Ñ‚Ðµ

Ð¡Ð¿Ñ€Ð¾ÑÐ¸ ÑÐµÐ±Ñ:
- **ÐœÐ¾Ð³Ñƒ Ð»Ð¸ Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ News Ð¸ Ð²ÑÑ‘ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ?** Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ - Ð¿Ð»Ð¾Ñ…Ð¾
- **ÐœÐ¾Ð³Ñƒ Ð»Ð¸ Ñ Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð½Ð° ÑÑ‚Ð°Ñ€ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ?** Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ - Ð¿Ð»Ð¾Ñ…Ð¾
- **ÐœÐ¾Ð³Ñƒ Ð»Ð¸ Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾?** Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ - Ð¿Ð»Ð¾Ñ…Ð¾
- **ÐœÐ¾Ð³Ñƒ Ð»Ð¸ Ñ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð² Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ð¸ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²?** Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ - Ð¿Ð»Ð¾Ñ…Ð¾

## ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´

ÐœÐ¾Ð´ÑƒÐ»Ð¸ Ð¾Ð±Ñ‰Ð°ÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡ÐµÑ€ÐµÐ·:
- **Ð¯Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ñ‹** (Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ props)
- **Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ** (Ð½Ðµ Ð·Ð½Ð°ÑŽÑ‚ Ð´Ñ€ÑƒÐ³ Ð¾ Ð´Ñ€ÑƒÐ³Ðµ)
- **Shared Ð¼Ð¾Ð´ÑƒÐ»ÑŒ** (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¾Ð±Ñ‰Ð¸Ñ… Ð²ÐµÑ‰ÐµÐ¹)
- **Backend API** (ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑÐ¾ ÑÐ²Ð¾Ð¸Ð¼, Ñ‚Ð¾ÐºÐµÐ½ Ð² ÐºÑƒÐºÐ°Ñ…)

ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿: Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ **Ð´ÐµÐ³Ñ€Ð°Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ gracefully** - ÐµÑÐ»Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ ÑÐ»Ð¾Ð¼Ð°Ð»ÑÑ, Ð¾Ð½ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ²Ð¾ÑŽ Ñ‡Ð°ÑÑ‚ÑŒ, Ð½Ð¾ Ð½Ðµ Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²ÐµÑÑŒ ÑÐ°Ð¹Ñ‚.

---

# Docker hack

ÐœÐ¾Ð¶Ð½Ð¾ Ð½Ðµ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð·, Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ Ð² alpine, Ð¿Ñ€Ð¸Ð¼Ð¾Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð² `/nix/store`. Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸ÐºÐ¸, ÑÐ¾Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ñ‡ÐµÑ€ÐµÐ· `nix build`, Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°.

1. Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ:
```bash
nix build .#gateway
```

2. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Dockerfile:
**Dockerfile.minimal**
```Dockerfile
FROM alpine:latest
WORKDIR /app
CMD ["echo", "Ready. Please provide a command to run, for example, a path from /nix/store."]
```

3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ (Ð¿Ñ€Ð¸Ð¼ÐµÑ€):
```bash
docker build -t gateway-base -f Dockerfile.minimal .

# GATEWAY_PATH - ÑÑ‚Ð¾ Ð¿ÑƒÑ‚ÑŒ Ðº Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñƒ ÑÐ±Ð¾Ñ€ÐºÐ¸ (readlink result)
docker run --rm -it \
         --name my-gateway \
         -p 8080:8080 \
         -v /nix/store:/nix/store:ro \
         gateway-base \
         "${GATEWAY_PATH}/bin/start-gateway"
```


# VictoriaMetrics

```
# Ð’ÑÐµ Ð»Ð¾Ð³Ð¸ Ð¾Ñ‚ ÑÐµÑ€Ð²Ð¸ÑÐ°
{"service.name"="greeter-service"}

# ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
{"service.name"=~"greeter-service|shell-service"}

# Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
{"service.name"=~".*"} AND level:ERROR

# Ð›Ð¾Ð³Ð¸ Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ð¼ trace_id
{"service.name"=~".*"} AND trace_id:"your-trace-id"

# Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð² Grafana)
{"service.name"="shell-service"} | filter _time:>now-1h
```
